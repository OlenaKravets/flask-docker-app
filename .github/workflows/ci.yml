name: Flask Docker CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build and run Docker Compose
        run: |
          docker compose up -d --build
          sleep 10

      - name: Check Flask is running
        run: |
          for i in {1..10}; do
            echo "‚è≥ –°–ø—Ä–æ–±–∞ $i: –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ Flask..."
            curl --fail http://localhost:5000 && exit 0
            echo "‚ùå –°–ø—Ä–æ–±–∞ $i: Flask —â–µ –Ω–µ –ø—ñ–¥–Ω—è–≤—Å—è. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 3 —Å–µ–∫..."
            sleep 3
          done
          echo "üö´ Flask —Ç–∞–∫ —ñ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–≤."
          exit 1

